LASER310机B文件处理系统
罗章寿 罗亚
软件报1987年8月16日
    LASER310机B文件（即机器语言程序）的分析和翻录是一件棘手的事。用BLOAD命令从磁盘上调入B文件，能“静止”于内存中，从而有办法去分析它；但由于不能直接找到其首末地址，想用BSAVE命令翻录也很伤脑筋。加上LASER机没有向磁带上录制和校核B文件的命令，因此要将磁盘B文件转录在磁带上难以实现，至于磁带B文件的分析翻录就更加困难。这类文件一经调入就自动运行，其中游戏类B文件往往难以中断（除非关机）；监控类B文件则往往在运行中作了自锁加密，即使能返回系统，内存中留下的已非庐山真貌；要想分析和翻录，既无手段，又找不到正确的信息目标。
    不少监控程序提供了录制磁带B文件的手段，但都存在局限性，如本身占用较长用户空间；只能处理特定区域的文件，调入程序常因“超界”而与监控手段冲突；有的能阻止磁带B文件运行却不能退出监控，无法引入其它手段进行分析；有的不能与DOS兼容……而且都未解决磁盘B文件向磁带上翻录和盘、带B文件相互转录的问题。
    86年第20期《软件报》曾发表“一种阻止程序自动运行的方法”，只及磁带B文件。该方法也不理想，不仅操作繁冗，易与目标程序冲突，而且翻录拖泥带水，要从参效区一直录到程序结束。例如某目标程序在B600-
B6FF，本身只有255字节，却得从7800录到B800，长达15.5K！另外，因用CSAVE命令录，B文件录成了T文件，却又不能用VERIFY命令校核。

    这里，向大家奉献我们编制的B文件处理工具程序，能较完满地解决上述所有问题。用机器码写成的源程序一只有190字节，还提供了，用BASIC语言写成的等效源程序二。为了方便群众、促进应用，有意未作加密处理。源程序一用BRUN或CRUN调入和源程序二用RUN运行，都将在高分辨显示区的末端设置一个B文件处理系统（以下简称B系统），其提示符为“？”。该系统共有五条指令，即：
	R（或R “文件名”）↙————调入磁带B文件
	L“文件名”↙————调入磁盘B文件
	W“文件名”（或W）↙————向磁带上录制B文件
    V（或V“文件名”）↙————校核磁带B文件
    E↙————退出B系统，清屏返回原系统。
	其中R、L、W、V命令执行完毕或中途出错、中断均留驻B系统。E命令退出后，随时可键入“PRINT&”再回车，又进入B系统。
    B系统的特点和功能是：
    1.设置在高分辨显示区末端，完全不挤占用户程序区，不受NEW命令影响，与磁盘DOS和获得全国评比一等奖的“MONITOR”等监控手段兼容。从7AE9————B7FF（基本系统）和7200————76FF范围内的一切盘、带B文件均能处理，不存在冲突问题。
    2.R命令调入的磁带B文件，能阻止运行，精确地“静止”于原始状态。然后用E命令退出，即可引入监控手段观察分析其庐山真面目。
    3.L命令对无盘系统不起作用。在带盘系统中，它既有与BLOAD命令相似的功能，又可为用W命令将磁盘B文件翻录在磁带上作好准备。退出B系统后同样可对调入文件进行分析研究。
    4.W命令能干净利落地将R命令调入的带B文件或L命令调入的磁盘B文件翻录在磁带上，其长度和内容均与母本完全相同，在B系统外一经调入就自动运行。
    5.V命令能将翻录在磁带上的B文件与静止在内存中的母本进行校核，如同VERIFY命令能对磁带T文件进行校核一样。
    6.B系统将R或L命令调入的文件首末地址存放于77BB————77BE（十进制30651————30654），用E命令退出后，可用PRINT PEEK(地址)顺序查出调入文件首址低位、高位和末址低位，高位，以供分析时确定区域和用BSAVE存盘之用。
    7.凡磁盘B文件和本身与DOS兼容的磁带B文件均可转录于磁盘。即用L或R命令调入，E命令退出，照6条所述查知首末地址，即可用BASVE命令存盘。而L，W命令配合，可将所有磁盘B文件翻录于磁带上。这就解决了盘、带B文件相工转录的问题。
    8.要对调入B文件作分折，应选择不与调入程序冲突的工具，为了保护调入信息，改执E命令后，文本区首地址指针30884，
30885和末地址指针30969、30970将改到调入程序的后面。当调入文件处于内存极高端时，E命令退出后将没有足够空间来键入程序或执行直接命令。此时若调入一个不与内存B文件冲突的盘、带文件（如监控程序），问题自会迎刃而解。若不打算调文件，则应键人POKE 30884,233:POKE 30885,122:NEW↙（若已无法键入，应先执行NEW），然后就可以键入、运行程序或直接命令了。
    9.用E命令退出B系能后，驻机BASIC的所有命令、功能均可正确执行，但其中用CLOAD命令（包括CRUN）调入的T文件，必须先键入POKE 30884,233:POKE 30885,122后，才能用LIST命令列表和用RUN命令运行。
	综上所述，利用B系统，配合各监控手段，能实现对LASER310机现有游戏、监控B文件的解密、分析、翻录（包括盘、带互录）。它不能处理的例外只有两个：一是用BSAVE命令录在磁盘上的MODE(1)显示画面，二是恰好也占用到高分辨区末端这百余字节的机器码程序。
	最后要提请使用者注意，在操作中应禁用MODE(1)命令，以免破坏系统。
